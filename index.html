<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BeyLab X - Professional Architect v2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;700;800&display=swap');
        
        :root {
            --bey-blue: #3b82f6;
            --bey-dark: #0f172a;
            --bey-accent: #06b6d4;
        }

        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background: #f1f5f9;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .neo-shadow {
            box-shadow: 0 10px 40px -10px rgba(0, 0, 0, 0.05);
        }

        .sidebar-link.active {
            background: var(--bey-blue);
            color: white;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .type-badge {
            font-size: 0.65rem;
            font-weight: 800;
            padding: 2px 8px;
            border-radius: 99px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .atk-bg { background: #fee2e2; color: #ef4444; }
        .def-bg { background: #dcfce7; color: #22c55e; }
        .sta-bg { background: #fef9c3; color: #ca8a04; }
        .bal-bg { background: #f3e8ff; color: #a855f7; }

        .radar-container {
            width: 100%;
            height: 350px;
            position: relative;
        }

        .grade-pill {
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-in { animation: slideIn 0.4s ease-out forwards; }

        .inventory-item:hover .delete-btn {
            opacity: 1;
            transform: scale(1);
        }
        .delete-btn {
            opacity: 0;
            transform: scale(0.8);
            transition: all 0.2s ease-in-out;
        }
    </style>
    <!-- Chosen Palette: Aero Carbon - Sfondo Slate-50, Sidebar Midnight, Accenti Blue-600 e Cyan. -->
    <!-- Application Structure Plan: 
         - Layout a Dashboard con Sidebar per navigazione rapida.
         - Sezione Archivio con filtri Serie e rimozione istantanea pezzi.
         - Workshop con simulazione radar 5-point.
         - Deck Manager con preview interattive.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
</head>
<body class="text-slate-900">

    <div class="flex min-h-screen">
        
        <!-- SIDEBAR -->
        <aside class="w-20 lg:w-64 bg-slate-900 text-white flex flex-col sticky top-0 h-screen z-50">
            <div class="p-6 flex items-center gap-3">
                <div class="w-10 h-10 bg-blue-600 rounded-xl flex items-center justify-center text-xl font-black italic shadow-lg shadow-blue-500/20">X</div>
                <h1 class="hidden lg:block font-black text-xl tracking-tighter">BEYLAB <span class="text-blue-500">PRO</span></h1>
            </div>
            
            <nav class="flex-1 px-4 py-10 space-y-4">
                <a href="#inventory" class="sidebar-link active flex items-center gap-4 p-4 rounded-2xl transition-all">
                    <span>üì¶</span> <span class="hidden lg:block font-bold">L'Archivio</span>
                </a>
                <a href="#builder" class="sidebar-link flex items-center gap-4 p-4 rounded-2xl transition-all text-slate-400 hover:text-white">
                    <span>üîß</span> <span class="hidden lg:block font-bold">Officina</span>
                </a>
                <a href="#deck" class="sidebar-link flex items-center gap-4 p-4 rounded-2xl transition-all text-slate-400 hover:text-white">
                    <span>üèÜ</span> <span class="hidden lg:block font-bold">Torneo</span>
                </a>
            </nav>

            <div class="p-6 border-t border-slate-800">
                <div class="hidden lg:block">
                    <p class="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Status Sistema</p>
                    <p class="text-xs text-green-400 flex items-center gap-2 mt-1">
                        <span class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></span> Nucleo Online
                    </p>
                </div>
            </div>
        </aside>

        <!-- MAIN CONTENT -->
        <main class="flex-1 p-4 lg:p-10 space-y-12">

            <!-- TOPBAR / SEARCH -->
            <section class="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-6">
                <div>
                    <h2 class="text-3xl font-extrabold text-slate-900 tracking-tight">Benvenuto nell'Area Sviluppo</h2>
                    <p class="text-slate-500 font-medium">Gestisci l'inventario globale e sperimenta nuove combinazioni.</p>
                </div>
                
                <div class="flex items-center gap-3 bg-white p-2 rounded-2xl neo-shadow w-full lg:w-auto">
                    <select id="masterSearch" class="bg-transparent border-none outline-none text-sm font-bold px-4 py-2 w-full lg:w-80">
                        <option value="">Cerca prodotto (Codice o Nome)...</option>
                    </select>
                    <button id="quickAddBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-xl font-bold text-xs uppercase tracking-widest transition-all active:scale-95">
                        Importa
                    </button>
                </div>
            </section>

            <!-- ARCHIVIO & FILTRI -->
            <section id="inventory" class="space-y-6 scroll-mt-24">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-bold flex items-center gap-2"><span>üìÇ</span> Archivio Componenti</h3>
                    <div class="flex gap-2">
                        <button class="filter-btn text-[10px] font-black uppercase px-3 py-1 bg-blue-50 text-blue-600 rounded-lg" data-filter="all">Tutti</button>
                        <button class="filter-btn text-[10px] font-black uppercase px-3 py-1 text-slate-400" data-filter="BX">BX</button>
                        <button class="filter-btn text-[10px] font-black uppercase px-3 py-1 text-slate-400" data-filter="UX">UX</button>
                        <button class="filter-btn text-[10px] font-black uppercase px-3 py-1 text-slate-400" data-filter="CX">CX</button>
                        <button class="filter-btn text-[10px] font-black uppercase px-3 py-1 text-slate-400" data-filter="Hasbro">Hasbro</button>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <!-- Blades -->
                    <div class="space-y-4">
                        <div class="flex items-center justify-between px-2">
                            <span class="text-[10px] font-black uppercase text-slate-400 tracking-widest">Lame (Blades)</span>
                            <span id="count-blades" class="text-xs font-bold text-blue-600 bg-blue-50 px-2 rounded-md">0</span>
                        </div>
                        <div id="inv-blades" class="grid grid-cols-1 gap-3 h-[450px] overflow-y-auto pr-2">
                            <div class="text-center py-20 bg-white rounded-3xl border border-dashed border-slate-200 text-slate-300 italic text-sm">Nessuna Blade</div>
                        </div>
                    </div>
                    <!-- Ratchets -->
                    <div class="space-y-4">
                        <div class="flex items-center justify-between px-2">
                            <span class="text-[10px] font-black uppercase text-slate-400 tracking-widest">Cricchetti (Ratchets)</span>
                            <span id="count-ratchets" class="text-xs font-bold text-blue-600 bg-blue-50 px-2 rounded-md">0</span>
                        </div>
                        <div id="inv-ratchets" class="grid grid-cols-1 gap-3 h-[450px] overflow-y-auto pr-2">
                            <div class="text-center py-20 bg-white rounded-3xl border border-dashed border-slate-200 text-slate-300 italic text-sm">Nessun Ratchet</div>
                        </div>
                    </div>
                    <!-- Bits -->
                    <div class="space-y-4">
                        <div class="flex items-center justify-between px-2">
                            <span class="text-[10px] font-black uppercase text-slate-400 tracking-widest">Punte (Bits)</span>
                            <span id="count-bits" class="text-xs font-bold text-blue-600 bg-blue-50 px-2 rounded-md">0</span>
                        </div>
                        <div id="inv-bits" class="grid grid-cols-1 gap-3 h-[450px] overflow-y-auto pr-2">
                            <div class="text-center py-20 bg-white rounded-3xl border border-dashed border-slate-200 text-slate-300 italic text-sm">Nessun Bit</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- FORGE (BUILDER) -->
            <section id="builder" class="grid grid-cols-1 xl:grid-cols-12 gap-8 scroll-mt-24">
                
                <div class="xl:col-span-4 bg-slate-900 rounded-[2.5rem] p-8 lg:p-10 text-white shadow-2xl relative overflow-hidden">
                    <div class="relative z-10 space-y-8">
                        <div>
                            <h3 class="text-2xl font-black italic uppercase text-blue-400">Officina di Assemblaggio</h3>
                            <p class="text-slate-400 text-sm">Combina i pezzi del tuo inventario.</p>
                        </div>

                        <div class="space-y-6">
                            <div class="group">
                                <label class="text-[10px] font-black uppercase text-slate-500 mb-2 block group-hover:text-blue-400 transition">Blade</label>
                                <select id="select-blade" class="w-full bg-slate-800/50 border border-slate-700 rounded-2xl px-5 py-4 text-sm font-bold outline-none focus:ring-2 focus:ring-blue-500 transition-all"></select>
                            </div>
                            <div class="group">
                                <label class="text-[10px] font-black uppercase text-slate-500 mb-2 block group-hover:text-blue-400 transition">Ratchet</label>
                                <select id="select-ratchet" class="w-full bg-slate-800/50 border border-slate-700 rounded-2xl px-5 py-4 text-sm font-bold outline-none focus:ring-2 focus:ring-blue-500 transition-all"></select>
                            </div>
                            <div class="group">
                                <label class="text-[10px] font-black uppercase text-slate-500 mb-2 block group-hover:text-blue-400 transition">Bit</label>
                                <select id="select-bit" class="w-full bg-slate-800/50 border border-slate-700 rounded-2xl px-5 py-4 text-sm font-bold outline-none focus:ring-2 focus:ring-blue-500 transition-all"></select>
                            </div>
                        </div>

                        <div class="pt-6 flex gap-4">
                            <button id="analyzeBtn" class="flex-1 bg-blue-600 hover:bg-blue-500 py-4 rounded-2xl font-black text-xs uppercase tracking-widest shadow-lg shadow-blue-500/20 transition-all">Analizza Build</button>
                            <button id="resetBuildBtn" class="px-6 py-4 bg-slate-800 text-slate-400 hover:text-white rounded-2xl transition-all">Reset</button>
                        </div>
                    </div>
                </div>

                <div class="xl:col-span-8 bg-white rounded-[2.5rem] p-8 lg:p-10 neo-shadow border border-slate-200 flex flex-col">
                    <div class="flex flex-col md:flex-row justify-between items-start gap-4 mb-8">
                        <div>
                            <h3 class="text-2xl font-black italic uppercase text-slate-800">Report Prestazioni</h3>
                            <div id="build-tag" class="text-[10px] font-black uppercase px-2 py-1 bg-slate-100 text-slate-400 rounded-md mt-1 inline-block">In attesa</div>
                        </div>
                        <div id="grade-pill" class="grade-pill w-20 h-20 rounded-3xl flex flex-col items-center justify-center border-4 border-slate-100 text-slate-300">
                            <span class="text-[9px] font-black uppercase leading-none">Grade</span>
                            <span class="text-4xl font-black italic">-</span>
                        </div>
                    </div>

                    <div class="flex-grow grid grid-cols-1 md:grid-cols-2 gap-10 items-center">
                        <div class="radar-container bg-slate-50/50 rounded-3xl p-4">
                            <canvas id="mainChart"></canvas>
                        </div>
                        
                        <div class="space-y-6">
                            <div class="glass-card p-6 rounded-3xl border border-slate-100 shadow-sm min-h-[160px]">
                                <h5 class="text-[10px] font-black uppercase text-blue-600 mb-3 tracking-widest flex items-center gap-2">
                                    <span>üí°</span> Verdetto Tecnico
                                </h5>
                                <div id="analysis-motivation" class="text-xs text-slate-600 leading-relaxed font-medium">
                                    Completa la combo per visualizzare le statistiche e il verdetto dell'IA.
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-2 gap-4">
                                <div class="p-4 bg-slate-50 rounded-2xl border border-slate-100 text-center">
                                    <span class="block text-[10px] font-black text-slate-400 uppercase mb-1">Massa</span>
                                    <span id="stat-weight" class="text-2xl font-black text-slate-800">--.- g</span>
                                </div>
                                <div class="p-4 bg-blue-900 rounded-2xl text-center text-white">
                                    <span class="block text-[10px] font-black text-blue-400 uppercase mb-1">Potenza</span>
                                    <span id="stat-power" class="text-2xl font-black italic">--</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <button id="addToDeckBtn" disabled class="mt-8 w-full py-5 border-2 border-dashed border-slate-200 text-slate-400 font-black text-[10px] uppercase tracking-[0.2em] rounded-3xl hover:border-blue-500 hover:text-blue-600 hover:bg-blue-50 transition-all disabled:opacity-50 disabled:cursor-not-allowed">
                        + Registra nel Deck Torneo
                    </button>
                </div>
            </section>

            <!-- DECK -->
            <section id="deck" class="space-y-6 pb-20 scroll-mt-24">
                <h3 class="text-2xl font-black italic uppercase">Squadra Torneo 3on3</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8" id="deck-container"></div>
            </section>

        </main>
    </div>

    <script>
        // --- DATABASE COMPLETO AGGIORNATO ---
        const MASTER_LIST = [
            // Takara BX
            { id: "BX-01", name: "Dran Sword 3-60F", parts: ["Dran Sword", "3-60", "Flat"], series: "BX" },
            { id: "BX-02", name: "Hells Scythe 4-60T", parts: ["Hells Scythe", "4-60", "Taper"], series: "BX" },
            { id: "BX-03", name: "Wizard Arrow 4-80B", parts: ["Wizard Arrow", "4-80", "Ball"], series: "BX" },
            { id: "BX-04", name: "Knight Shield 3-80N", parts: ["Knight Shield", "3-80", "Needle"], series: "BX" },
            { id: "BX-13", name: "Knight Lance 4-80HN", parts: ["Knight Lance", "4-80", "High Needle"], series: "BX" },
            { id: "BX-14", name: "Shark Edge 3-60LF", parts: ["Shark Edge", "3-60", "Low Flat"], series: "BX" },
            { id: "BX-15", name: "Leon Claw 5-60P", parts: ["Leon Claw", "5-60", "Point"], series: "BX" },
            { id: "BX-19", name: "Rhino Horn 3-80S", parts: ["Rhino Horn", "3-80", "Spike"], series: "BX" },
            { id: "BX-23", name: "Phoenix Wing 9-60GF", parts: ["Phoenix Wing", "9-60", "Gear Flat"], series: "BX" },
            { id: "BX-26", name: "Unicorn Sting 5-60GP", parts: ["Unicorn Sting", "5-60", "Gear Point"], series: "BX" },
            { id: "BX-31", name: "Tyranno Beat 4-70Q", parts: ["Tyranno Beat", "4-70", "Quake"], series: "BX" },
            { id: "BX-33", name: "Weiss Tiger 3-60U", parts: ["Weiss Tiger", "3-60", "Unite"], series: "BX" },
            { id: "BX-34", name: "Cobalt Dragoon 2-60C", parts: ["Cobalt Dragoon", "2-60", "Cyclone"], series: "BX" },
            { id: "BX-35", name: "Black Shell 4-60D", parts: ["Black Shell", "4-60", "Dot"], series: "BX" },
            { id: "BX-36", name: "Whale Wave 5-80E", parts: ["Whale Wave", "5-80", "Elevate"], series: "BX" },
            // Takara UX
            { id: "UX-01", name: "Dran Buster 1-60A", parts: ["Dran Buster", "1-60", "Accel"], series: "UX" },
            { id: "UX-02", name: "Hells Hammer 3-70H", parts: ["Hells Hammer", "3-70", "Hexa"], series: "UX" },
            { id: "UX-03", name: "Wizard Rod 5-70DB", parts: ["Wizard Rod", "5-70", "Disc Ball"], series: "UX" },
            { id: "UX-06", name: "Leon Crest 7-60GN", parts: ["Leon Crest", "7-60", "Gear Needle"], series: "UX" },
            { id: "UX-08", name: "Silver Wolf 3-80FB", parts: ["Silver Wolf", "3-80", "Free Ball"], series: "UX" },
            // Hasbro
            { id: "F9580", name: "Sword Dran 3-60F", parts: ["Sword Dran", "3-60", "Flat"], series: "Hasbro" },
            { id: "F9583", name: "Scythe Incendio 4-60T", parts: ["Scythe Incendio", "4-60", "Taper"], series: "Hasbro" },
            { id: "G1537", name: "Wand Wizard 5-70DB", parts: ["Wand Wizard", "5-70", "Disc Ball"], series: "Hasbro" }
        ];

        const COMP_STATS = {
            blades: {
                "Dran Sword": { type: "Attack", weight: 35.1, stats: [85, 20, 15, 60, 50], series: "BX" },
                "Hells Scythe": { type: "Balance", weight: 32.5, stats: [55, 55, 60, 65, 55], series: "BX" },
                "Wizard Arrow": { type: "Stamina", weight: 31.8, stats: [20, 30, 95, 50, 45], series: "BX" },
                "Knight Shield": { type: "Defense", weight: 33.2, stats: [35, 90, 40, 80, 50], series: "BX" },
                "Knight Lance": { type: "Defense", weight: 33.5, stats: [40, 85, 40, 75, 50], series: "BX" },
                "Shark Edge": { type: "Attack", weight: 33.8, stats: [98, 10, 10, 45, 60], series: "BX" },
                "Leon Claw": { type: "Balance", weight: 32.1, stats: [60, 45, 45, 65, 50], series: "BX" },
                "Rhino Horn": { type: "Defense", weight: 31.2, stats: [30, 80, 20, 95, 40], series: "BX" },
                "Phoenix Wing": { type: "Attack", weight: 38.2, stats: [95, 35, 25, 60, 65], series: "BX" },
                "Unicorn Sting": { type: "Balance", weight: 33.2, stats: [65, 60, 50, 70, 55], series: "BX" },
                "Tyranno Beat": { type: "Attack", weight: 36.8, stats: [90, 30, 25, 60, 55], series: "BX" },
                "Weiss Tiger": { type: "Balance", weight: 34.0, stats: [75, 50, 55, 60, 55], series: "BX" },
                "Cobalt Dragoon": { type: "Attack", weight: 37.5, stats: [95, 25, 20, 55, 60], series: "BX" },
                "Black Shell": { type: "Defense", weight: 34.8, stats: [35, 95, 30, 85, 50], series: "BX" },
                "Whale Wave": { type: "Attack", weight: 36.0, stats: [88, 30, 20, 60, 55], series: "BX" },
                "Wizard Rod": { type: "Stamina", weight: 36.5, stats: [25, 45, 100, 60, 55], series: "UX" },
                "Dran Buster": { type: "Attack", weight: 37.8, stats: [100, 15, 10, 55, 60], series: "UX" },
                "Hells Hammer": { type: "Balance", weight: 35.5, stats: [75, 40, 40, 70, 55], series: "UX" },
                "Leon Crest": { type: "Defense", weight: 37.5, stats: [30, 100, 35, 85, 55], series: "UX" },
                "Silver Wolf": { type: "Stamina", weight: 37.0, stats: [35, 40, 98, 65, 50], series: "UX" },
                "Scythe Incendio": { type: "Balance", weight: 32.8, stats: [55, 55, 65, 65, 55], series: "Hasbro" },
                "Sword Dran": { type: "Attack", weight: 35.1, stats: [85, 20, 15, 55, 50], series: "Hasbro" }
            },
            ratchets: {
                "3-60": 6.5, "4-60": 6.8, "5-60": 7.2, "9-60": 7.5, "3-80": 7.0, "5-80": 7.8, "4-80": 7.3, "1-60": 6.4, "3-70": 6.8, "7-60": 7.4
            },
            bits: {
                "Flat": "Attack", "Taper": "Balance", "Ball": "Stamina", "Needle": "Defense", "Accel": "Attack", "Low Flat": "Attack", "Point": "Balance", "Orb": "Stamina", "Gear Flat": "Attack", "Quake": "Attack", "Unite": "Balance", "Cyclone": "Stamina", "Disc Ball": "Stamina", "Hexa": "Defense", "Spike": "Defense", "High Needle": "Defense"
            }
        };

        const state = {
            inventory: { blades: {}, ratchets: {}, bits: {} },
            deck: [null, null, null],
            chart: null,
            filter: 'all'
        };

        // --- CORE LOGIC ---

        function init() {
            populateSearch();
            initChart();
            loadState();
            renderAll();
            setupFilters();
        }

        function populateSearch() {
            const s = document.getElementById('masterSearch');
            MASTER_LIST.forEach((p, i) => {
                const o = document.createElement('option');
                o.value = i;
                o.textContent = `[${p.id}] ${p.name}`;
                s.appendChild(o);
            });
        }

        function setupFilters() {
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.filter-btn').forEach(b => {
                        b.classList.remove('bg-blue-50', 'text-blue-600');
                        b.classList.add('text-slate-400');
                    });
                    btn.classList.remove('text-slate-400');
                    btn.classList.add('bg-blue-50', 'text-blue-600');
                    state.filter = btn.dataset.filter;
                    renderAll();
                });
            });
        }

        document.getElementById('quickAddBtn').addEventListener('click', () => {
            const idx = document.getElementById('masterSearch').value;
            if (idx === "") return;
            const p = MASTER_LIST[idx];
            const add = (cat, n) => state.inventory[cat][n] = (state.inventory[cat][n] || 0) + 1;
            add('blades', p.parts[0]); add('ratchets', p.parts[1]); add('bits', p.parts[2]);
            saveState(); renderAll(); updateDropdowns();
        });

        function removeItem(cat, name) {
            if (state.inventory[cat][name] > 0) {
                state.inventory[cat][name]--;
                if (state.inventory[cat][name] === 0) {
                    delete state.inventory[cat][name];
                }
            }
            saveState();
            renderAll();
            updateDropdowns();
        }

        function renderAll() {
            const draw = (cat, elId) => {
                const container = document.getElementById(elId);
                container.innerHTML = '';
                const items = Object.entries(state.inventory[cat]).filter(([name]) => {
                    if (state.filter === 'all') return true;
                    if (cat === 'blades') return COMP_STATS.blades[name]?.series === state.filter;
                    return true;
                });

                document.getElementById('count-' + cat).innerText = items.reduce((acc, curr) => acc + curr[1], 0);

                if (!items.length) {
                    container.innerHTML = `<div class="text-center py-20 bg-white rounded-3xl border border-dashed border-slate-200 text-slate-300 italic text-sm">Nessun componente trovato</div>`;
                    return;
                }

                items.forEach(([name, count]) => {
                    const info = cat === 'blades' ? COMP_STATS.blades[name] : null;
                    const typeClass = info ? `type-badge ${info.type.toLowerCase().substring(0,3)}-bg` : 'type-badge bg-slate-100 text-slate-400';
                    
                    const div = document.createElement('div');
                    div.className = "animate-in bg-white p-4 rounded-2xl neo-shadow flex justify-between items-center group relative border border-transparent hover:border-blue-100 transition-all inventory-item";
                    div.innerHTML = `
                        <div class="flex flex-col gap-1">
                            <span class="${typeClass}">${info ? info.type : 'Pezzo'}</span>
                            <span class="text-xs font-extrabold text-slate-800">${name}</span>
                        </div>
                        <div class="flex items-center gap-3">
                            <span class="text-[10px] font-bold text-blue-600 bg-blue-50 px-2 py-1 rounded-md">x${count}</span>
                            <button onclick="removeItem('${cat}', '${name}')" class="delete-btn bg-red-50 text-red-500 w-8 h-8 rounded-lg flex items-center justify-center">üóëÔ∏è</button>
                        </div>
                    `;
                    container.appendChild(div);
                });
            };
            draw('blades', 'inv-blades');
            draw('ratchets', 'inv-ratchets');
            draw('bits', 'inv-bits');
        }

        function updateDropdowns() {
            const sync = (id, cat) => {
                const s = document.getElementById(id); const prev = s.value;
                s.innerHTML = `<option value="">Scegli...</option>`;
                Object.keys(state.inventory[cat]).forEach(n => {
                    const o = document.createElement('option'); o.value = n; o.textContent = n; s.appendChild(o);
                });
                if (state.inventory[cat][prev]) s.value = prev;
            };
            sync('select-blade', 'blades'); sync('select-ratchet', 'ratchets'); sync('select-bit', 'bits');
        }

        // --- ANALYSIS ---
        function initChart() {
            const ctx = document.getElementById('mainChart').getContext('2d');
            state.chart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['ATTACCO', 'DIFESA', 'STAMINA', 'PESO', 'REAZIONI'],
                    datasets: [{
                        data: [0,0,0,0,0], backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        borderColor: 'rgba(59, 130, 246, 1)', borderWidth: 3, pointRadius: 0
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    scales: { 
                        r: { 
                            suggestedMin: 0, suggestedMax: 100, ticks: { display: false }, 
                            grid: { color: '#f1f5f9' }, angleLines: { color: '#f1f5f9' }, 
                            pointLabels: { font: { size: 9, weight: '800' }, color: '#94a3b8' } 
                        } 
                    },
                    plugins: { legend: { display: false } }
                }
            });
        }

        document.getElementById('analyzeBtn').addEventListener('click', () => {
            const b = document.getElementById('select-blade').value;
            const r = document.getElementById('select-ratchet').value;
            const bit = document.getElementById('select-bit').value;
            if (!b || !r || !bit) return;

            const bD = COMP_STATS.blades[b], rW = COMP_STATS.ratchets[r], bitT = COMP_STATS.bits[bit];
            const wT = bD.weight + rW + 2.0;
            
            const stats = [...bD.stats]; 
            stats[3] = Math.round((wT / 49) * 100); 

            state.chart.data.datasets[0].data = stats;
            state.chart.update();

            document.getElementById('stat-weight').textContent = wT.toFixed(1) + " g";
            document.getElementById('stat-power').textContent = Math.round(stats[0] * (wT/35));
            
            const typeTag = document.getElementById('build-tag');
            typeTag.textContent = bD.type + " Build";
            typeTag.className = `text-[10px] font-black uppercase px-2 py-1 rounded-md mt-1 inline-block ${bD.type.toLowerCase().substring(0,3)}-bg`;

            const avg = stats.reduce((a,c) => a+c, 0)/5;
            let g = 'C'; if (avg > 78) g = 'S'; else if (avg > 66) g = 'A'; else if (avg > 52) g = 'B';
            const badge = document.getElementById('grade-pill');
            badge.className = `grade-pill w-20 h-20 rounded-3xl flex flex-col items-center justify-center border-4 transition-all duration-500 grade-${g.toLowerCase()}`;
            badge.querySelector('span:last-child').textContent = g;

            let motiv = `Build <strong>${bD.type}</strong>. `;
            if (wT > 45) motiv += `Il peso elevato fornisce un vantaggio inerziale dominante. `;
            if (bitT === bD.type) motiv += `Ottima sinergia tra lama e punta. `;
            
            document.getElementById('analysis-motivation').innerHTML = motiv;
            document.getElementById('addToDeckBtn').disabled = false;
            state.currentBuild = { b, r, bit, g };
        });

        // --- DECK ---
        document.getElementById('addToDeckBtn').addEventListener('click', () => {
            const slot = state.deck.findIndex(s => s === null);
            if (slot === -1) return;
            state.deck[slot] = { ...state.currentBuild };
            renderDeck();
        });

        function renderDeck() {
            const container = document.getElementById('deck-container'); container.innerHTML = '';
            state.deck.forEach((b, i) => {
                const d = document.createElement('div');
                d.className = "h-56 rounded-[2.5rem] border-2 transition-all p-8 flex flex-col justify-center items-center text-center " + 
                    (b ? "bg-white border-slate-200 shadow-xl" : "border-dashed border-slate-200 bg-slate-50/50");
                
                if (b) {
                    d.innerHTML = `
                        <div class="w-full text-left animate-in">
                            <div class="flex justify-between items-center mb-4">
                                <span class="text-[9px] font-black text-blue-500 uppercase tracking-widest">Build #${i+1}</span>
                                <span class="text-xs font-black italic px-2 py-0.5 rounded-md grade-${b.g.toLowerCase()}">${b.g}</span>
                            </div>
                            <h5 class="text-sm font-black text-slate-800">${b.b}</h5>
                            <p class="text-[10px] font-bold text-slate-400 mt-1">${b.r} / ${b.bit}</p>
                            <button onclick="removeDeck(${i})" class="mt-6 w-full py-2 bg-red-50 text-red-500 text-[9px] font-black uppercase rounded-xl hover:bg-red-500 hover:text-white transition-all">Rimuovi</button>
                        </div>
                    `;
                } else {
                    d.innerHTML = `<span class="text-xs font-bold text-slate-300 uppercase tracking-widest">Libero</span>`;
                }
                container.appendChild(d);
            });
        }

        function removeDeck(i) { state.deck[i] = null; renderDeck(); }
        function saveState() { localStorage.setItem('beylab_pro_v2_final', JSON.stringify(state.inventory)); }
        function loadState() { const s = localStorage.getItem('beylab_pro_v2_final'); if(s) state.inventory = JSON.parse(s); }

        window.onload = init;
    </script>
</body>
</html>
