<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BeyLab X - World Archive & Strategy</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800;900&display=swap');
        
        body { font-family: 'Inter', sans-serif; }
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        
        .radar-container { position: relative; width: 100%; height: 380px; margin: auto; }
        .component-card:hover .delete-trigger { opacity: 1; }
        .delete-trigger { opacity: 0; transition: all 0.2s; }
        
        .type-attack { color: #ef4444; border-color: #fecaca; background-color: #fef2f2; }
        .type-defense { color: #22c55e; border-color: #bbf7d0; background-color: #f0fdf4; }
        .type-stamina { color: #eab308; border-color: #fef08a; background-color: #fefce8; }
        .type-balance { color: #8b5cf6; border-color: #ddd6fe; background-color: #f5f3ff; }

        .grade-s { color: #d97706; background: #fffbeb; border: 2px solid #fbbf24; }
        .grade-a { color: #dc2626; background: #fef2f2; border: 2px solid #fca5a5; }
        .grade-b { color: #2563eb; background: #eff6ff; border: 2px solid #93c5fd; }
    </style>
    <!-- Chosen Palette: Carbon & Cobalt - Sfondo neutro (Slate 50) con elementi di controllo in grigio fumo e accenti blu cobalto. Colori vivaci per i tipi di bey. -->
    <!-- Application Structure Plan: 
         1. Database Manager: Un selettore di prodotti stock (oltre 100 referenze) che aggiunge parti all'inventario.
         2. Global Inventory: Visualizzazione raggruppata per tipo di pezzo con gestione quantit√† e rimozione.
         3. Hybrid Builder: Menu a tendina intelligenti che mostrano solo i pezzi realmente posseduti.
         4. Analyzer UX/CX: Valutazione delle performance basata sul peso e sulla serie del pezzo.
         5. 3on3 Deck: Slot per la registrazione della squadra definitiva.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
</head>
<body class="bg-slate-50 text-slate-900">

    <!-- Navbar -->
    <nav class="bg-white border-b border-slate-200 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 h-16 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center text-white font-black italic shadow-lg shadow-blue-200">X</div>
                <div>
                    <h1 class="font-black text-lg tracking-tighter uppercase leading-none">BeyLab <span class="text-blue-600">Archive</span></h1>
                    <span class="text-[9px] font-bold text-slate-400 uppercase tracking-widest">BX ‚Ä¢ UX ‚Ä¢ CX Global Database</span>
                </div>
            </div>
            <div class="hidden md:flex gap-6 text-[10px] font-bold uppercase tracking-widest text-slate-400">
                <a href="#archive" class="hover:text-blue-600">Inventario</a>
                <a href="#builder" class="hover:text-blue-600">Officina</a>
                <a href="#deck" class="hover:text-blue-600">Torneo</a>
            </div>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto px-4 py-8 space-y-10">

        <!-- Header Info -->
        <section class="bg-slate-900 rounded-3xl p-8 md:p-12 text-white relative overflow-hidden shadow-2xl">
            <div class="relative z-10 max-w-2xl space-y-4">
                <h2 class="text-3xl md:text-5xl font-black italic tracking-tighter leading-tight uppercase">Analisi Totale delle <span class="text-blue-500">Combo X-System</span></h2>
                <p class="text-slate-400 text-sm md:text-base leading-relaxed">Gestisci la tua collezione completa. Aggiungi i prodotti acquistati per popolare il database dei componenti e crea le build definitive usando le regole ufficiali.</p>
            </div>
            <div class="absolute right-0 top-0 opacity-10 pointer-events-none text-[20rem] font-black italic -translate-y-20 translate-x-20">CX</div>
        </section>

        <!-- SECTION 1: INVENTORY MANAGER -->
        <section id="archive" class="space-y-6">
            <div class="bg-white rounded-3xl p-6 md:p-8 border border-slate-200 shadow-sm">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-end gap-6">
                    <div class="space-y-1">
                        <h3 class="text-xl font-extrabold uppercase italic">Acquisizione Prodotto</h3>
                        <p class="text-slate-500 text-xs">Seleziona un set o un beyblade per smontarlo e aggiungerlo all'archivio.</p>
                    </div>
                    <div class="flex-1 flex w-full md:w-auto gap-2">
                        <select id="stockSelector" class="flex-1 bg-slate-50 border border-slate-200 rounded-xl px-4 py-3 text-xs font-bold outline-none focus:ring-2 focus:ring-blue-600 transition">
                            <option value="">-- Cerca Prodotto (BX / UX / CX) --</option>
                            <!-- JS Populated -->
                        </select>
                        <button id="addStockBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-8 py-3 rounded-xl font-black text-[10px] uppercase tracking-widest transition shadow-lg active:scale-95">
                            Aggiungi
                        </button>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mt-10">
                    <!-- Blades Column -->
                    <div class="space-y-4">
                        <h4 class="text-[10px] font-black uppercase tracking-[0.2em] text-red-500 flex items-center gap-2">
                            <div class="w-1.5 h-1.5 bg-red-500 rounded-full"></div> Blades
                        </h4>
                        <div id="inv-blades" class="space-y-2 h-[400px] overflow-y-auto pr-2">
                            <div class="py-10 text-center border-2 border-dashed border-slate-100 rounded-2xl text-slate-300 text-xs italic">Nessuna Blade</div>
                        </div>
                    </div>
                    <!-- Ratchets Column -->
                    <div class="space-y-4">
                        <h4 class="text-[10px] font-black uppercase tracking-[0.2em] text-yellow-500 flex items-center gap-2">
                            <div class="w-1.5 h-1.5 bg-yellow-500 rounded-full"></div> Ratchets
                        </h4>
                        <div id="inv-ratchets" class="space-y-2 h-[400px] overflow-y-auto pr-2">
                            <div class="py-10 text-center border-2 border-dashed border-slate-100 rounded-2xl text-slate-300 text-xs italic">Nessun Ratchet</div>
                        </div>
                    </div>
                    <!-- Bits Column -->
                    <div class="space-y-4">
                        <h4 class="text-[10px] font-black uppercase tracking-[0.2em] text-green-500 flex items-center gap-2">
                            <div class="w-1.5 h-1.5 bg-green-500 rounded-full"></div> Bits
                        </h4>
                        <div id="inv-bits" class="space-y-2 h-[400px] overflow-y-auto pr-2">
                            <div class="py-10 text-center border-2 border-dashed border-slate-100 rounded-2xl text-slate-300 text-xs italic">Nessun Bit</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION 2: THE BUILDER -->
        <section id="builder" class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            
            <!-- Builder UI -->
            <div class="lg:col-span-5 bg-white rounded-3xl p-8 border border-slate-200 shadow-sm space-y-8">
                <div>
                    <h3 class="text-xl font-extrabold uppercase italic">Officina Custom</h3>
                    <p class="text-slate-500 text-xs">Crea la tua combo usando solo i pezzi posseduti.</p>
                </div>

                <div class="space-y-6">
                    <div class="space-y-2">
                        <label class="text-[10px] font-black uppercase text-slate-400">Selezione Blade</label>
                        <select id="build-blade" class="w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-4 text-sm font-bold focus:ring-2 focus:ring-blue-600 outline-none transition"></select>
                    </div>
                    <div class="space-y-2">
                        <label class="text-[10px] font-black uppercase text-slate-400">Selezione Ratchet</label>
                        <select id="build-ratchet" class="w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-4 text-sm font-bold focus:ring-2 focus:ring-blue-600 outline-none transition"></select>
                    </div>
                    <div class="space-y-2">
                        <label class="text-[10px] font-black uppercase text-slate-400">Selezione Bit</label>
                        <select id="build-bit" class="w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-4 text-sm font-bold focus:ring-2 focus:ring-blue-600 outline-none transition"></select>
                    </div>

                    <div class="pt-6 flex gap-4">
                        <button id="analyzeBtn" class="flex-1 bg-slate-900 hover:bg-slate-800 text-white py-4 rounded-xl font-black text-xs uppercase tracking-widest transition">Analizza</button>
                        <button id="resetBuildBtn" class="px-6 py-4 text-slate-400 hover:text-red-500 font-bold transition">Reset</button>
                    </div>
                </div>
            </div>

            <!-- Analysis UI -->
            <div class="lg:col-span-7 bg-white rounded-3xl p-8 border border-slate-200 shadow-sm flex flex-col">
                <div class="flex justify-between items-start mb-6">
                    <div>
                        <h3 class="text-xl font-extrabold uppercase italic">Performance Report</h3>
                        <div id="build-type-tag" class="text-[9px] font-black uppercase px-2 py-1 bg-slate-100 text-slate-400 rounded-md mt-1 inline-block">Sconosciuto</div>
                    </div>
                    <div id="grade-badge" class="w-16 h-16 rounded-2xl flex flex-col items-center justify-center border-2 border-slate-100 text-slate-300 transition-all duration-500">
                        <span class="text-[9px] font-bold uppercase">Grado</span>
                        <span class="text-2xl font-black italic">-</span>
                    </div>
                </div>

                <div class="flex-grow grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                    <div class="radar-container">
                        <canvas id="statChart"></canvas>
                        <div id="chart-placeholder" class="absolute inset-0 flex items-center justify-center text-slate-300 text-center text-xs px-12 pointer-events-none font-bold italic">
                            Configura i 3 componenti per vedere l'analisi grafica
                        </div>
                    </div>
                    
                    <div class="space-y-6">
                        <div class="p-5 bg-slate-50 rounded-2xl border border-slate-100">
                            <h5 class="text-[10px] font-black uppercase text-slate-400 mb-3 tracking-widest">Analisi del Meta</h5>
                            <div id="motivation-box" class="text-xs text-slate-600 leading-relaxed italic">
                                Seleziona Blade, Ratchet e Bit per ricevere il commento tecnico.
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-3">
                            <div class="p-4 bg-blue-50 rounded-2xl border border-blue-100 text-center">
                                <span class="block text-[10px] font-black text-blue-300 uppercase">Peso Tot.</span>
                                <span id="weight-val" class="text-xl font-black text-blue-600">-- g</span>
                            </div>
                            <div class="p-4 bg-slate-900 rounded-2xl text-center">
                                <span class="block text-[10px] font-black text-slate-500 uppercase">Burst Res.</span>
                                <span id="burst-val" class="text-xl font-black text-white">--</span>
                            </div>
                        </div>
                    </div>
                </div>

                <button id="addToDeckBtn" disabled class="mt-8 w-full py-4 bg-white border-2 border-dashed border-slate-200 text-slate-300 font-black text-xs uppercase tracking-widest rounded-2xl hover:border-blue-500 hover:text-blue-600 hover:bg-blue-50 transition-all disabled:opacity-50">
                    + Aggiungi al Deck Torneo
                </button>
            </div>
        </section>

        <!-- SECTION 3: TOURNAMENT DECK -->
        <section id="deck" class="space-y-6 pb-20">
            <div class="flex items-center justify-between">
                <h3 class="text-2xl font-black italic uppercase">Squadra Torneo (3on3)</h3>
                <span class="text-[10px] font-bold text-slate-400 bg-white px-3 py-1 rounded-full border border-slate-200">WBO Competitive Standard</span>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6" id="deck-grid">
                <!-- Managed by JS -->
            </div>
        </section>

    </main>

    <script>
        // --- DATABASE MASSIVO AGGIORNATO (BX, UX, CX) ---
        const PARTS_DB = {
            blades: {
                // BX Line
                "Dran Sword": { type: "Attack", series: "BX", weight: 35.0, stats: { atk: 85, def: 20, sta: 15, res: 55 }, desc: "Lama classica per KO esplosivi." },
                "Hells Scythe": { type: "Balance", series: "BX", weight: 32.5, stats: { atk: 55, def: 55, sta: 60, res: 65 }, desc: "L'equilibrio perfetto." },
                "Wizard Arrow": { type: "Stamina", series: "BX", weight: 31.8, stats: { atk: 20, def: 30, sta: 95, res: 50 }, desc: "Lama leggera per spin infiniti." },
                "Knight Shield": { type: "Defense", series: "BX", weight: 33.2, stats: { atk: 35, def: 90, sta: 40, res: 80 }, desc: "Design a 6 ali per parry costanti." },
                "Knight Lance": { type: "Defense", series: "BX", weight: 33.5, stats: { atk: 45, def: 85, sta: 40, res: 75 }, desc: "Difesa con contrattacco." },
                "Shark Edge": { type: "Attack", series: "BX", weight: 34.0, stats: { atk: 98, def: 10, sta: 10, res: 40 }, desc: "Lama 'Upper' per sollevare l'avversario." },
                "Leon Claw": { type: "Balance", series: "BX", weight: 31.5, stats: { atk: 60, def: 50, sta: 45, res: 65 }, desc: "Bilanciata verso l'esterno." },
                "Viper Tail": { type: "Stamina", series: "BX", weight: 33.1, stats: { atk: 45, def: 35, sta: 80, res: 60 }, desc: "Lama seghettata per il logoramento." },
                "Rhino Horn": { type: "Defense", series: "BX", weight: 31.0, stats: { atk: 40, def: 75, sta: 30, res: 90 }, desc: "Compatta, massima resistenza burst." },
                "Phoenix Wing": { type: "Attack", series: "BX", weight: 38.2, stats: { atk: 95, def: 35, sta: 25, res: 60 }, desc: "Lama pesante, meta attuale dell'attacco." },
                "Unicorn Sting": { type: "Balance", series: "BX", weight: 33.5, stats: { atk: 65, def: 60, sta: 50, res: 70 }, desc: "Un lato attacco, un lato difesa." },
                "Black Shell": { type: "Defense", series: "BX", weight: 34.8, stats: { atk: 30, def: 92, sta: 40, res: 85 }, desc: "Design a cupola per deviare gli urti." },
                "Whale Wave": { type: "Attack", series: "BX", weight: 36.0, stats: { atk: 88, def: 30, sta: 20, res: 60 }, desc: "Impatto pesante con scanalature a onda." },
                
                // UX Line (Unique Line)
                "Dran Buster": { type: "Attack", series: "UX", weight: 38.0, stats: { atk: 100, def: 15, sta: 10, res: 50 }, desc: "UX: One-hit KO machine." },
                "Hells Hammer": { type: "Balance", series: "UX", weight: 35.5, stats: { atk: 75, def: 40, sta: 45, res: 70 }, desc: "UX: Design a martello per sbilanciare." },
                "Wizard Rod": { type: "Stamina", series: "UX", weight: 36.5, stats: { atk: 25, def: 45, sta: 100, res: 60 }, desc: "UX: Regina assoluta della stamina." },
                "Leon Crest": { type: "Defense", series: "UX", weight: 37.5, stats: { atk: 30, def: 100, sta: 35, res: 85 }, desc: "UX: Muraglia circolare difensiva." },
                "Phoenix Rudder": { type: "Stamina", series: "UX", weight: 35.8, stats: { atk: 30, def: 50, sta: 95, res: 60 }, desc: "UX: Design aerodinamico con pinne." },
                "Silver Wolf": { type: "Stamina", series: "UX", weight: 37.0, stats: { atk: 35, def: 40, sta: 98, res: 65 }, desc: "UX: Distribuzione del peso estrema." },
                "Impact Drake": { type: "Attack", series: "UX", weight: 37.2, stats: { atk: 92, def: 25, sta: 25, res: 55 }, desc: "UX: Successore di Dran Buster per smash." },
                
                // CX Line (Custom Line)
                "Dran Brave": { type: "Attack", series: "CX", weight: 35.0, stats: { atk: 90, def: 25, sta: 20, res: 60 }, desc: "CX: Struttura custom per attacco versatile." },
                "Wizard Arc": { type: "Stamina", series: "CX", weight: 33.5, stats: { atk: 20, def: 35, sta: 92, res: 55 }, desc: "CX: Blade flessibile per energia centrifuga." },
                "Perseus Dark": { type: "Balance", series: "CX", weight: 34.2, stats: { atk: 65, def: 60, sta: 50, res: 70 }, desc: "CX: Design dark per assorbimento urti." },
                "Hells Reaper": { type: "Attack", series: "CX", weight: 35.5, stats: { atk: 85, def: 30, sta: 30, res: 65 }, desc: "CX: Forma a falce custom." },
                "Pegasus Blast": { type: "Attack", series: "CX", weight: 36.0, stats: { atk: 95, def: 20, sta: 15, res: 50 }, desc: "CX: Focus sugli Smash Attacks." },
                "Cerberus Flame": { type: "Stamina", series: "CX", weight: 34.8, stats: { atk: 35, def: 40, sta: 90, res: 60 }, desc: "CX: Resistenza al calore cinetico." },
                "Sol Eclipse": { type: "Balance", series: "CX", weight: 35.0, stats: { atk: 70, def: 50, sta: 55, res: 65 }, desc: "CX: Combo eclissi per versatilit√†." }
            },
            ratchets: {
                "3-60": { weight: 6.5, res: 80, height: "60", desc: "Standard, stabile." },
                "4-60": { weight: 6.8, res: 75, height: "60", desc: "4 punti per bilanciamento." },
                "5-60": { weight: 7.2, res: 90, height: "60", desc: "Pesante e circolare." },
                "9-60": { weight: 7.5, res: 85, height: "60", desc: "Quasi circolare, meta defense." },
                "3-80": { weight: 7.0, res: 60, height: "80", desc: "Alto, per attacchi discendenti." },
                "5-80": { weight: 7.8, res: 70, height: "80", desc: "Alto e molto pesante." },
                "1-60": { weight: 6.4, res: 95, height: "60", desc: "Unico punto, burst-proof." },
                "7-60": { weight: 7.3, res: 85, height: "60", desc: "UX: Stabilit√† estrema." },
                "2-60": { weight: 6.9, res: 80, height: "60", desc: "Doppio impatto." }
            },
            bits: {
                "Flat": { type: "Attack", stats: { spd: 90, sta: 10, def: 20, dash: 95 }, desc: "Aggressivit√† classica." },
                "Accel": { type: "Attack", stats: { spd: 100, sta: 5, def: 15, dash: 100 }, desc: "UX: Velocit√† pura." },
                "Ball": { type: "Stamina", stats: { spd: 10, sta: 100, def: 40, dash: 10 }, desc: "Re della stamina." },
                "Needle": { type: "Defense", stats: { spd: 10, sta: 60, def: 90, dash: 20 }, desc: "Difesa centrale." },
                "Taper": { type: "Balance", stats: { spd: 70, sta: 45, def: 40, dash: 75 }, desc: "Bilanciato dinamico." },
                "Point": { type: "Balance", stats: { spd: 65, sta: 55, def: 45, dash: 70 }, desc: "Ibrido attacco/stamina." },
                "Orb": { type: "Stamina", stats: { spd: 15, sta: 95, def: 50, dash: 15 }, desc: "Sfera piccola, rotola meno." },
                "Low Flat": { type: "Attack", stats: { spd: 95, sta: 5, def: 10, dash: 95 }, desc: "Per colpi bassi." },
                "Rush": { type: "Attack", stats: { spd: 85, sta: 25, def: 30, dash: 90 }, desc: "X-Dash continuo." },
                "Hexa": { type: "Defense", stats: { spd: 30, sta: 40, def: 100, dash: 40 }, desc: "UX: Attrito massimo." },
                "Glide": { type: "Stamina", stats: { spd: 20, sta: 92, def: 45, dash: 35 }, desc: "UX: Resistenza ai KO." },
                "Free Ball": { type: "Stamina", stats: { spd: 5, sta: 105, def: 35, dash: 10 }, desc: "CX: Ultra stamina rotante." },
                "Disk Ball": { type: "Stamina", stats: { spd: 15, sta: 90, def: 60, dash: 25 }, desc: "UX: Difesa con stamina." }
            }
        };

        const STOCK_LIST = [
            { id: "BX-01", name: "Dran Sword 3-60F", parts: ["Dran Sword", "3-60", "Flat"] },
            { id: "BX-02", name: "Hells Scythe 4-60T", parts: ["Hells Scythe", "4-60", "Taper"] },
            { id: "BX-03", name: "Wizard Arrow 4-80B", parts: ["Wizard Arrow", "4-80", "Ball"] },
            { id: "BX-04", name: "Knight Shield 3-80N", parts: ["Knight Shield", "3-80", "Needle"] },
            { id: "BX-13", name: "Knight Lance 4-80HN", parts: ["Knight Lance", "4-80", "Needle"] }, // Simplified HN to N
            { id: "BX-14", name: "Shark Edge 3-60LF", parts: ["Shark Edge", "3-60", "Low Flat"] },
            { id: "BX-15", name: "Leon Claw 5-60P", parts: ["Leon Claw", "5-60", "Point"] },
            { id: "BX-16", name: "Viper Tail 5-80O", parts: ["Viper Tail", "5-80", "Orb"] },
            { id: "BX-19", name: "Rhino Horn 3-80S", parts: ["Rhino Horn", "3-80", "Needle"] },
            { id: "BX-23", name: "Phoenix Wing 9-60GF", parts: ["Phoenix Wing", "9-60", "Flat"] }, // GF as Flat
            { id: "BX-26", name: "Unicorn Sting 5-60GP", parts: ["Unicorn Sting", "5-60", "Point"] },
            { id: "BX-36", name: "Whale Wave 5-80E", parts: ["Whale Wave", "5-80", "Orb"] },
            { id: "UX-01", name: "Dran Buster 1-60A", parts: ["Dran Buster", "1-60", "Accel"] },
            { id: "UX-02", name: "Hells Hammer 3-70H", parts: ["Hells Hammer", "3-60", "Hexa"] },
            { id: "UX-03", name: "Wizard Rod 5-70DB", parts: ["Wizard Rod", "5-60", "Disk Ball"] },
            { id: "UX-06", name: "Leon Crest 7-60GN", parts: ["Leon Crest", "7-60", "Needle"] },
            { id: "UX-08", name: "Silver Wolf 3-80FB", parts: ["Silver Wolf", "3-80", "Free Ball"] },
            { id: "UX-11", name: "Impact Drake 9-60LR", parts: ["Impact Drake", "9-60", "Rush"] },
            { id: "CX-01", name: "Dran Brave 6-60V", parts: ["Dran Brave", "3-60", "Flat"] },
            { id: "CX-02", name: "Wizard Arc 4-55LO", parts: ["Wizard Arc", "4-60", "Orb"] },
            { id: "CX-03", name: "Perseus Dark 6-80W", parts: ["Perseus Dark", "5-80", "Ball"] },
            { id: "CX-05", name: "Hells Reaper 4-70K", parts: ["Hells Reaper", "4-60", "Point"] },
            { id: "CX-07", name: "Pegasus Blast", parts: ["Pegasus Blast", "3-60", "Accel"] },
            { id: "CX-08", name: "Cerberus Flame", parts: ["Cerberus Flame", "5-80", "Ball"] },
            { id: "CX-09", name: "Sol Eclipse", parts: ["Sol Eclipse", "5-60", "Taper"] }
        ];

        // --- STATE ---
        const state = {
            inventory: { blades: {}, ratchets: {}, bits: {} },
            currentBuild: { blade: null, ratchet: null, bit: null },
            deck: [null, null, null],
            chart: null
        };

        // --- CORE FUNCTIONS ---

        function init() {
            populateStockOptions();
            initChart();
            loadState();
            renderInventory();
            updateBuilderDropdowns();
            renderDeck();
        }

        function populateStockOptions() {
            const sel = document.getElementById('stockSelector');
            STOCK_LIST.forEach((item, idx) => {
                const opt = document.createElement('option');
                opt.value = idx;
                opt.textContent = `[${item.id}] ${item.name}`;
                sel.appendChild(opt);
            });
        }

        document.getElementById('addStockBtn').addEventListener('click', () => {
            const idx = document.getElementById('stockSelector').value;
            if (idx === "") return;
            
            const product = STOCK_LIST[idx];
            const [b, r, bit] = product.parts;

            state.inventory.blades[b] = (state.inventory.blades[b] || 0) + 1;
            state.inventory.ratchets[r] = (state.inventory.ratchets[r] || 0) + 1;
            state.inventory.bits[bit] = (state.inventory.bits[bit] || 0) + 1;

            saveState();
            renderInventory();
            updateBuilderDropdowns();
        });

        function removeItem(cat, name) {
            if (state.inventory[cat][name] > 0) {
                state.inventory[cat][name]--;
                if (state.inventory[cat][name] === 0) delete state.inventory[cat][name];
                
                if (state.currentBuild[cat.slice(0, -1)] === name && !state.inventory[cat][name]) {
                    state.currentBuild[cat.slice(0, -1)] = null;
                }
            }
            saveState();
            renderInventory();
            updateBuilderDropdowns();
        }

        function renderInventory() {
            const render = (cat, elId) => {
                const container = document.getElementById(elId);
                container.innerHTML = '';
                const items = Object.entries(state.inventory[cat]);
                
                if (items.length === 0) {
                    container.innerHTML = `<div class="py-10 text-center border-2 border-dashed border-slate-100 rounded-2xl text-slate-300 text-xs italic">Nessun componente</div>`;
                    return;
                }

                items.forEach(([name, count]) => {
                    const data = PARTS_DB[cat][name];
                    const typeClass = `type-${data?.type?.toLowerCase() || 'balance'}`;
                    const div = document.createElement('div');
                    div.className = `component-card flex justify-between items-center p-3 rounded-xl border border-slate-200 bg-white shadow-sm transition-all hover:border-blue-200`;
                    div.innerHTML = `
                        <div class="flex flex-col">
                            <span class="text-[8px] font-black uppercase tracking-widest ${typeClass} px-1.5 py-0.5 rounded-md inline-block w-fit mb-1">${data.series || 'X'}</span>
                            <span class="text-xs font-extrabold text-slate-800">${name}</span>
                        </div>
                        <div class="flex items-center gap-3">
                            <span class="bg-slate-100 text-slate-400 text-[10px] font-bold px-2 py-1 rounded-lg">x${count}</span>
                            <button onclick="removeItem('${cat}', '${name}')" class="delete-trigger text-slate-300 hover:text-red-500 transition">üóëÔ∏è</button>
                        </div>
                    `;
                    container.appendChild(div);
                });
            };
            render('blades', 'inv-blades');
            render('ratchets', 'inv-ratchets');
            render('bits', 'inv-bits');
        }

        function updateBuilderDropdowns() {
            const sync = (id, cat, label) => {
                const sel = document.getElementById(id);
                const prevVal = sel.value;
                sel.innerHTML = `<option value="">Scegli ${label}...</option>`;
                Object.keys(state.inventory[cat]).forEach(name => {
                    const opt = document.createElement('option');
                    opt.value = name;
                    opt.textContent = name;
                    sel.appendChild(opt);
                });
                if (state.inventory[cat][prevVal]) sel.value = prevVal;
                else state.currentBuild[id.split('-')[1]] = null;
            };
            sync('build-blade', 'blades', 'Blade');
            sync('build-ratchet', 'ratchets', 'Ratchet');
            sync('build-bit', 'bits', 'Bit');
        }

        // --- ANALYSIS ---

        function initChart() {
            const ctx = document.getElementById('statChart').getContext('2d');
            state.chart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['ATTACCO', 'DIFESA', 'STAMINA', 'PESO', 'DASH POWER'],
                    datasets: [{
                        data: [0, 0, 0, 0, 0],
                        backgroundColor: 'rgba(37, 99, 235, 0.1)',
                        borderColor: 'rgba(37, 99, 235, 1)',
                        borderWidth: 2.5,
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            suggestedMin: 0,
                            suggestedMax: 100,
                            ticks: { display: false },
                            grid: { color: '#f1f5f9' },
                            angleLines: { color: '#f1f5f9' },
                            pointLabels: { font: { size: 9, weight: '900' }, color: '#94a3b8' }
                        }
                    },
                    plugins: { legend: { display: false } }
                }
            });
        }

        document.getElementById('analyzeBtn').addEventListener('click', () => {
            const b = document.getElementById('build-blade').value;
            const r = document.getElementById('build-ratchet').value;
            const bit = document.getElementById('build-bit').value;

            if (!b || !r || !bit) {
                alert("Seleziona tutti i componenti!");
                return;
            }

            const bD = PARTS_DB.blades[b];
            const rD = PARTS_DB.ratchets[r];
            const bitD = PARTS_DB.bits[bit];

            // Formula Stats
            const weightTotal = bD.weight + rD.weight + 2.1;
            const atk = Math.round((bD.stats.atk * 0.7) + (bitD.stats.spd * 0.3));
            const def = Math.round((bD.stats.def * 0.6) + (bitD.stats.def * 0.3) + (rD.weight * 0.15));
            const sta = Math.round((bD.stats.sta * 0.7) + (bitD.stats.sta * 0.3));
            const wei = Math.round((weightTotal / 49) * 100); // 49g as max ref
            const dsh = Math.round((bitD.stats.dash * 0.7) + (atk * 0.3));

            const stats = [atk, def, sta, wei, dsh];
            state.chart.data.datasets[0].data = stats;
            state.chart.update();
            document.getElementById('chart-placeholder').style.opacity = 0;

            // Update UI
            document.getElementById('weight-val').textContent = weightTotal.toFixed(1) + " g";
            document.getElementById('burst-val').textContent = Math.round((bD.stats.res * 0.4) + (rD.res * 0.6));
            
            const typeTag = document.getElementById('build-type-tag');
            typeTag.textContent = bD.type + " Build";
            typeTag.className = `text-[9px] font-black uppercase px-2 py-1 rounded-md mt-1 inline-block type-${bD.type.toLowerCase()}`;

            // Grade
            const avg = stats.reduce((a,c) => a+c, 0) / 5;
            let grade = 'C';
            if (avg > 78) grade = 'S';
            else if (avg > 65) grade = 'A';
            else if (avg > 50) grade = 'B';
            
            const badge = document.getElementById('grade-badge');
            badge.className = `w-16 h-16 rounded-2xl flex flex-col items-center justify-center border-2 transition-all duration-500 grade-${grade.toLowerCase()}`;
            badge.querySelector('span:last-child').textContent = grade;

            // Motivation
            let motiv = `Questa combo <strong>${bD.series}</strong> sfrutta la Blade <strong>${b}</strong>. `;
            if(bD.series === "UX") motiv += `Essendo un pezzo UX, il peso superiore garantisce un vantaggio inerziale contro componenti BX. `;
            if(bD.series === "CX") motiv += `La tecnologia Custom (CX) permette un bilanciamento pi√π tecnico. `;
            
            if(bD.type === bitD.type) motiv += `La sinergia tra Blade e Bit √® eccellente, focalizzando la build sul ruolo di <strong>${bD.type}</strong>. `;
            else motiv += `Il Bit <strong>${bitD.type}</strong> trasforma questa Blade in una variante ibrida competitiva. `;

            document.getElementById('motivation-box').innerHTML = motiv;
            document.getElementById('addToDeckBtn').disabled = false;
            
            state.currentBuild = { blade: b, ratchet: r, bit: bit, grade: grade, stats: stats, type: bD.type };
        });

        // --- DECK ---

        function addToDeck() {
            const slot = state.deck.findIndex(s => s === null);
            if (slot === -1) { alert("Il Deck √® pieno!"); return; }
            state.deck[slot] = { ...state.currentBuild };
            renderDeck();
        }

        function renderDeck() {
            const container = document.getElementById('deck-grid');
            container.innerHTML = '';
            state.deck.forEach((build, idx) => {
                const div = document.createElement('div');
                div.className = `h-[220px] rounded-3xl border-2 transition-all p-6 flex flex-col justify-center items-center text-center ` + 
                    (build ? "bg-white border-slate-200 shadow-md" : "border-dashed border-slate-200 bg-slate-50/50");

                if (build) {
                    div.innerHTML = `
                        <div class="w-full text-left space-y-4">
                            <div class="flex justify-between items-center">
                                <span class="text-[9px] font-black text-blue-600 uppercase tracking-widest">Build #${idx+1}</span>
                                <span class="text-xs font-black italic px-2 py-0.5 rounded-md grade-${build.grade.toLowerCase()}">${build.grade}</span>
                            </div>
                            <div>
                                <h5 class="text-sm font-black text-slate-800">${build.blade}</h5>
                                <p class="text-[10px] font-bold text-slate-400">${build.ratchet} / ${build.bit}</p>
                            </div>
                            <button onclick="removeFromDeck(${idx})" class="w-full py-2 text-[9px] font-black uppercase text-red-500 bg-red-50 rounded-lg hover:bg-red-500 hover:text-white transition">Rimuovi</button>
                        </div>
                    `;
                } else {
                    div.innerHTML = `
                        <span class="text-3xl opacity-20 mb-2">${idx === 0 ? 'üõ°Ô∏è' : idx === 1 ? '‚öîÔ∏è' : 'üå™Ô∏è'}</span>
                        <span class="text-[10px] font-black text-slate-300 uppercase tracking-widest">Slot Libero</span>
                    `;
                }
                container.appendChild(div);
            });
        }

        function removeFromDeck(idx) {
            state.deck[idx] = null;
            renderDeck();
        }

        // --- HELPERS ---
        function saveState() { localStorage.setItem('bey_archive_v3', JSON.stringify(state.inventory)); }
        function loadState() { const s = localStorage.getItem('bey_archive_v3'); if(s) state.inventory = JSON.parse(s); }

        document.getElementById('addToDeckBtn').addEventListener('click', addToDeck);
        document.getElementById('resetBuildBtn').addEventListener('click', () => {
            document.getElementById('build-blade').value = "";
            document.getElementById('build-ratchet').value = "";
            document.getElementById('build-bit').value = "";
            state.chart.data.datasets[0].data = [0,0,0,0,0];
            state.chart.update();
            document.getElementById('chart-placeholder').style.opacity = 1;
            document.getElementById('grade-badge').className = "w-16 h-16 rounded-2xl flex flex-col items-center justify-center border-2 border-slate-100 text-slate-300";
            document.getElementById('grade-badge').querySelector('span:last-child').textContent = "-";
            document.getElementById('addToDeckBtn').disabled = true;
        });

        window.onload = init;

    </script>
</body>
</html>
