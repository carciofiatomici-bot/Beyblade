<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BeyLab X: Ultimate Archive & Builder</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f8fafc; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        
        .radar-container {
            position: relative;
            width: 100%;
            height: 350px;
            max-width: 450px;
            margin: auto;
        }

        .inventory-card {
            transition: all 0.2s ease;
        }

        .inventory-card:hover .delete-overlay {
            opacity: 1;
        }

        .delete-overlay {
            opacity: 0;
            transition: opacity 0.2s;
        }

        .grade-s { color: #eab308; border-color: #eab308; background: #fefce8; }
        .grade-a { color: #ef4444; border-color: #ef4444; background: #fef2f2; }
        .grade-b { color: #3b82f6; border-color: #3b82f6; background: #eff6ff; }
        .grade-c { color: #64748b; border-color: #64748b; background: #f8fafc; }
    </style>
    <!-- Chosen Palette: Pro Lab White - Sfondo pulito con accenti tech blu cobalto e grigio ardesia. Colori vivaci per i tipi: Rosso (Attacco), Verde (Difesa), Giallo (Stamina), Viola (Bilanciamento). -->
    <!-- Application Structure Plan: 
         - Unified Dashboard: Una singola vista divisa in tre aree funzionali.
         - Archivio Dinamico: Sistema di filtraggio per rarit√†/serie (X, UX, CX) e gestione stock.
         - Officina UX: Calcolatore di statistiche basato su dati reali di peso e attrito.
         - Deck Torneo: Visualizzazione finale delle 3 combo scelte.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
</head>
<body class="bg-slate-50 text-slate-900 font-sans antialiased">

    <!-- Header -->
    <header class="bg-white border-b border-slate-200 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 h-16 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-slate-900 rounded-xl flex items-center justify-center text-white font-black text-xl tracking-tighter italic">X</div>
                <div class="leading-none">
                    <h1 class="text-xl font-black tracking-tighter uppercase">BeyLab <span class="text-blue-600">Ultimate</span></h1>
                    <p class="text-[10px] text-slate-400 font-bold uppercase tracking-widest">Database Serie X / UX / CX</p>
                </div>
            </div>
            <div class="hidden md:flex gap-8 text-xs font-black uppercase tracking-widest text-slate-400">
                <a href="#archive" class="hover:text-blue-600 transition">Archivio</a>
                <a href="#builder" class="hover:text-blue-600 transition">Officina</a>
                <a href="#deck" class="hover:text-blue-600 transition">Deck</a>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 py-8 space-y-12">

        <!-- SECTION 1: DATABASE & AGGIUNTA -->
        <section id="archive" class="space-y-6">
            <div class="bg-white rounded-3xl p-6 md:p-8 shadow-sm border border-slate-200">
                <div class="flex flex-col md:flex-row md:items-center justify-between gap-6">
                    <div class="max-w-md">
                        <h2 class="text-2xl font-black italic uppercase text-slate-800">Il Tuo Arsenale</h2>
                        <p class="text-slate-500 text-sm mt-1">Aggiungi i tuoi Beyblade acquistati. Il Lab estrarr√† Blade, Ratchet e Bit per la tua officina.</p>
                    </div>
                    
                    <div class="flex-1 flex gap-2">
                        <select id="stockSelector" class="flex-1 bg-slate-50 border border-slate-200 rounded-xl px-4 py-3 text-sm font-medium focus:ring-2 focus:ring-blue-600 outline-none transition">
                            <option value="">-- Seleziona Beyblade (Serie X, UX, CX) --</option>
                            <!-- JS Populated -->
                        </select>
                        <button id="addStockBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-8 py-3 rounded-xl font-black text-xs uppercase tracking-widest transition shadow-lg shadow-blue-100 active:scale-95">
                            Acquista
                        </button>
                    </div>
                </div>

                <!-- Liste Archivio -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-10">
                    <!-- Blade List -->
                    <div class="space-y-4">
                        <h4 class="text-[10px] font-black uppercase tracking-[0.2em] text-red-500 flex items-center gap-2">
                            <span class="w-2 h-2 bg-red-500 rounded-full"></span> Blades Possedute
                        </h4>
                        <div id="inv-blades" class="space-y-2 h-72 overflow-y-auto pr-2">
                            <p class="text-slate-300 text-xs italic py-10 text-center border-2 border-dashed border-slate-100 rounded-2xl">Nessun componente</p>
                        </div>
                    </div>
                    <!-- Ratchet List -->
                    <div class="space-y-4">
                        <h4 class="text-[10px] font-black uppercase tracking-[0.2em] text-yellow-500 flex items-center gap-2">
                            <span class="w-2 h-2 bg-yellow-500 rounded-full"></span> Ratchets Posseduti
                        </h4>
                        <div id="inv-ratchets" class="space-y-2 h-72 overflow-y-auto pr-2">
                            <p class="text-slate-300 text-xs italic py-10 text-center border-2 border-dashed border-slate-100 rounded-2xl">Nessun componente</p>
                        </div>
                    </div>
                    <!-- Bit List -->
                    <div class="space-y-4">
                        <h4 class="text-[10px] font-black uppercase tracking-[0.2em] text-green-500 flex items-center gap-2">
                            <span class="w-2 h-2 bg-green-500 rounded-full"></span> Bits Posseduti
                        </h4>
                        <div id="inv-bits" class="space-y-2 h-72 overflow-y-auto pr-2">
                            <p class="text-slate-300 text-xs italic py-10 text-center border-2 border-dashed border-slate-100 rounded-2xl">Nessun componente</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION 2: BUILDER & ANALYSIS -->
        <section id="builder" class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            
            <!-- Selection Panel -->
            <div class="lg:col-span-5 space-y-6">
                <div class="bg-slate-900 rounded-3xl p-8 text-white shadow-xl">
                    <h3 class="text-xl font-black italic uppercase mb-6 flex items-center gap-3">
                        <span class="text-blue-500">üõ†Ô∏è</span> Officina Build
                    </h3>
                    
                    <div class="space-y-5">
                        <div class="space-y-2">
                            <label class="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Base Blade</label>
                            <select id="select-blade" class="w-full bg-slate-800 border border-slate-700 rounded-xl px-4 py-3 text-sm focus:ring-2 focus:ring-blue-500 outline-none transition"></select>
                        </div>
                        <div class="space-y-2">
                            <label class="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Cricchetto (Ratchet)</label>
                            <select id="select-ratchet" class="w-full bg-slate-800 border border-slate-700 rounded-xl px-4 py-3 text-sm focus:ring-2 focus:ring-blue-500 outline-none transition"></select>
                        </div>
                        <div class="space-y-2">
                            <label class="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Punta (Bit)</label>
                            <select id="select-bit" class="w-full bg-slate-800 border border-slate-700 rounded-xl px-4 py-3 text-sm focus:ring-2 focus:ring-blue-500 outline-none transition"></select>
                        </div>
                        
                        <div class="pt-6 flex gap-3">
                            <button id="analyzeBtn" class="flex-1 bg-blue-600 hover:bg-blue-500 py-4 rounded-xl font-black text-xs uppercase tracking-widest transition">Analizza Combo</button>
                            <button id="resetBuildBtn" class="px-6 py-4 bg-slate-800 text-slate-400 hover:text-white rounded-xl transition">Reset</button>
                        </div>
                    </div>
                </div>

                <!-- Info Box -->
                <div id="part-info-box" class="bg-white rounded-2xl p-6 border border-slate-200 hidden shadow-sm">
                    <h4 class="text-xs font-black uppercase text-slate-400 mb-2">Dettagli Componenti</h4>
                    <div id="part-info-content" class="text-xs text-slate-600 space-y-2"></div>
                </div>
            </div>

            <!-- Analysis Panel -->
            <div class="lg:col-span-7">
                <div class="bg-white rounded-3xl p-8 shadow-sm border border-slate-200 h-full flex flex-col">
                    <div class="flex justify-between items-start mb-8">
                        <div>
                            <h3 class="text-2xl font-black italic uppercase">Performance Report</h3>
                            <div id="type-indicator" class="mt-1 text-[10px] font-black uppercase bg-slate-100 text-slate-400 px-2 py-1 rounded inline-block">Sconosciuto</div>
                        </div>
                        <div id="grade-badge" class="w-20 h-20 rounded-2xl flex flex-col items-center justify-center border-4 grade-c transition-all duration-500">
                            <span class="text-[10px] font-bold uppercase leading-none">Grade</span>
                            <span class="text-4xl font-black italic">-</span>
                        </div>
                    </div>

                    <div class="flex-grow grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                        <div class="radar-container">
                            <canvas id="analysisChart"></canvas>
                            <div id="chart-overlay" class="absolute inset-0 flex items-center justify-center text-slate-300 text-center text-sm px-10 pointer-events-none">
                                Seleziona tutti i componenti per generare il grafico radar
                            </div>
                        </div>
                        
                        <div class="space-y-6">
                            <div class="p-5 bg-slate-50 rounded-2xl border border-slate-100">
                                <h4 class="text-[10px] font-black uppercase text-slate-400 mb-3">Valutazione Strategica</h4>
                                <div id="motivation-text" class="text-sm text-slate-600 leading-relaxed italic">
                                    In attesa di dati build...
                                </div>
                            </div>
                            
                            <div class="flex gap-4">
                                <div class="flex-1 p-4 bg-blue-50 rounded-2xl border border-blue-100 text-center">
                                    <span class="block text-[10px] font-black text-blue-400 uppercase">Peso Totale</span>
                                    <span id="weight-value" class="text-2xl font-black text-blue-700">--.- g</span>
                                </div>
                                <div class="flex-1 p-4 bg-slate-900 rounded-2xl text-center">
                                    <span class="block text-[10px] font-black text-slate-500 uppercase">Potenza KO</span>
                                    <span id="ko-value" class="text-2xl font-black text-white">--</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <button id="saveDeckBtn" disabled class="mt-8 w-full py-4 bg-white border-2 border-dashed border-slate-200 text-slate-400 font-black text-xs uppercase tracking-[0.2em] rounded-2xl hover:border-blue-500 hover:text-blue-600 hover:bg-blue-50 transition-all disabled:opacity-50 disabled:cursor-not-allowed">
                        Aggiungi al Deck Torneo
                    </button>
                </div>
            </div>
        </section>

        <!-- SECTION 3: DECK -->
        <section id="deck" class="space-y-6 pb-20">
            <div class="flex items-center justify-between">
                <h3 class="text-2xl font-black italic uppercase">Il Tuo Deck Torneo (3on3)</h3>
                <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Le tue migliori strategie</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6" id="deck-display">
                <!-- Slots Managed by JS -->
            </div>
        </section>

    </main>

    <script>
        // --- DATABASE MASSIVO BEYBLADE X (BX, UX, CX) ---
        const PARTS_DB = {
            blades: {
                // BX Line (X)
                "Dran Sword": { type: "Attack", series: "BX", weight: 35.1, stats: { atk: 85, def: 20, sta: 15, res: 55 }, desc: "Lama classica a 3 punte, letale per i KO." },
                "Hells Scythe": { type: "Balance", series: "BX", weight: 32.4, stats: { atk: 55, def: 55, sta: 60, res: 65 }, desc: "Forma a falce per un perfetto equilibrio." },
                "Wizard Arrow": { type: "Stamina", series: "BX", weight: 31.2, stats: { atk: 15, def: 25, sta: 95, res: 50 }, desc: "Profilo sottile per rotazione duratura." },
                "Knight Shield": { type: "Defense", series: "BX", weight: 33.1, stats: { atk: 30, def: 90, sta: 40, res: 80 }, desc: "Forma esagonale per assorbire gli impatti." },
                "Shark Edge": { type: "Attack", series: "BX", weight: 33.8, stats: { atk: 98, def: 10, sta: 10, res: 40 }, desc: "Lama aggressiva per colpi uppercut estremi." },
                "Leon Claw": { type: "Balance", series: "BX", weight: 32.1, stats: { atk: 65, def: 45, sta: 45, res: 60 }, desc: "Bilanciato verso l'esterno per parry efficaci." },
                "Phoenix Wing": { type: "Attack", series: "BX", weight: 38.2, stats: { atk: 95, def: 30, sta: 25, res: 60 }, desc: "Metallo pesante esterno, top tier per attacco." },
                "Viper Tail": { type: "Stamina", series: "BX", weight: 33.5, stats: { atk: 40, def: 35, sta: 85, res: 55 }, desc: "Lama discendente per destabilizzare l'avversario." },
                "Unicorn Sting": { type: "Balance", series: "BX", weight: 33.2, stats: { atk: 70, def: 55, sta: 50, res: 70 }, desc: "Un lato attacco, un lato difesa." },
                // UX Line (Unique Xtreme)
                "Dran Buster": { type: "Attack", series: "UX", weight: 37.8, stats: { atk: 100, def: 15, sta: 10, res: 50 }, desc: "UX: Punta singola massiccia per One-Hit KO." },
                "Hells Hammer": { type: "Balance", series: "UX", weight: 35.2, stats: { atk: 80, def: 40, sta: 40, res: 65 }, desc: "UX: Tre martelli per schiacciare l'avversario." },
                "Wizard Rod": { type: "Stamina", series: "UX", weight: 36.1, stats: { atk: 25, def: 45, sta: 100, res: 60 }, desc: "UX: Distribuzione del peso esterna estrema. Meta definer." },
                "Leon Crest": { type: "Defense", series: "UX", weight: 37.5, stats: { atk: 30, def: 100, sta: 35, res: 85 }, desc: "UX: Cerchio metallico completo per difesa assoluta." },
                "Tyranno Beat": { type: "Attack", series: "UX", weight: 36.5, stats: { atk: 92, def: 35, sta: 20, res: 55 }, desc: "UX: Lama seghettata per attacchi a raffica." },
                "Weiss Tiger": { type: "Balance", series: "UX", weight: 34.0, stats: { atk: 75, def: 50, sta: 55, res: 60 }, desc: "UX: Bilanciata con metallo asimmetrico." },
                // CX / Altre Speciali (Custom Xtreme)
                "Dran Sky": { type: "Attack", series: "CX", weight: 34.5, stats: { atk: 88, def: 20, sta: 20, res: 60 }, desc: "CX: Specializzata in Smash Attack dall'alto." },
                "Hells Chain": { type: "Balance", series: "CX", weight: 33.8, stats: { atk: 60, def: 60, sta: 55, res: 70 }, desc: "Lama versatile con design a catena." },
                "Phoenix Rudder": { type: "Stamina", series: "CX", weight: 35.5, stats: { atk: 30, def: 40, sta: 98, res: 55 }, desc: "CX: Altissima stabilit√† grazie alle pinne esterne." },
                "Crimson Fold": { type: "Defense", series: "CX", weight: 36.0, stats: { atk: 35, def: 95, sta: 45, res: 75 }, desc: "CX: Specializzata nel parry dei colpi UX." }
            },
            ratchets: {
                "1-60": { weight: 6.8, burst: 95, height: "Low", desc: "Singola sporgenza, massima difesa burst." },
                "3-60": { weight: 6.4, burst: 80, height: "Low", desc: "Standard a 3 punti." },
                "5-60": { weight: 7.2, burst: 90, height: "Low", desc: "5 punti, molto bilanciato." },
                "9-60": { weight: 7.5, burst: 85, height: "Low", desc: "Design quasi circolare per difesa UX." },
                "3-80": { weight: 7.1, burst: 50, height: "High", desc: "Alto profilo per attacchi dall'alto." },
                "5-80": { weight: 7.8, burst: 70, height: "High", desc: "Alto e pesante." },
                "2-60": { weight: 6.9, burst: 85, height: "Low", desc: "Due punti massicci." },
                "7-60": { weight: 7.3, burst: 80, height: "Low", desc: "7 punti per stabilit√† estrema." },
                "1-80": { weight: 7.4, burst: 60, height: "High", desc: "Singolo punto alto." }
            },
            bits: {
                "Accel": { type: "Attack", spd: 100, sta: 5, def: 15, dsh: 100, desc: "UX: Ingranaggio pi√π grande per X-Dash fulminei." },
                "Flat": { type: "Attack", spd: 90, sta: 10, def: 20, dsh: 95, desc: "Base piatta per movimento aggressivo." },
                "Low Flat": { type: "Attack", spd: 95, sta: 5, def: 15, dsh: 95, desc: "Pi√π basso per colpi dal basso." },
                "Gear Flat": { type: "Attack", spd: 110, sta: 0, def: 10, dsh: 110, desc: "Massimo attrito sull'X-Line." },
                "Rush": { type: "Attack", spd: 85, sta: 25, def: 25, dsh: 90, desc: "X-Dash continuo." },
                "Ball": { type: "Stamina", spd: 10, sta: 100, def: 40, dsh: 15, desc: "Standard stamina, stabilit√† incredibile." },
                "Orb": { type: "Stamina", spd: 15, sta: 95, def: 55, dsh: 15, desc: "Sfera piccola, rotola meno ma pi√π difensiva." },
                "Glide": { type: "Stamina", spd: 20, sta: 90, def: 45, dsh: 30, desc: "UX: Progettata per resistere ai KO pesanti." },
                "Disc": { type: "Defense", spd: 25, sta: 55, def: 95, dsh: 35, desc: "UX: Forma a disco per parry laterale." },
                "Needle": { type: "Defense", spd: 10, sta: 65, def: 90, dsh: 20, desc: "Resta al centro e resiste agli urti." },
                "Hexa": { type: "Defense", spd: 30, sta: 40, def: 100, dsh: 45, desc: "Esagonale, attrito massimo." },
                "Point": { type: "Balance", spd: 65, sta: 55, def: 40, dsh: 70, desc: "Versatile, cambia stile con l'inclinazione." },
                "Taper": { type: "Attack", spd: 75, sta: 40, def: 35, dsh: 80, desc: "Attacco bilanciato." },
                "Quake": { type: "Attack", spd: 80, sta: 10, def: 20, dsh: 85, desc: "Punta tagliata per salti imprevedibili." }
            }
        };

        const STOCK_PRODUCTS = [
            { name: "BX-01 Dran Sword 3-60F", parts: ["Dran Sword", "3-60", "Flat"] },
            { name: "BX-02 Hells Scythe 4-60T", parts: ["Hells Scythe", "5-60", "Taper"] },
            { name: "BX-03 Wizard Arrow 4-80B", parts: ["Wizard Arrow", "5-80", "Ball"] },
            { name: "BX-04 Knight Shield 3-80N", parts: ["Knight Shield", "3-80", "Needle"] },
            { name: "BX-14 Shark Edge 3-60LF", parts: ["Shark Edge", "3-60", "Low Flat"] },
            { name: "BX-23 Phoenix Wing 9-60GF", parts: ["Phoenix Wing", "9-60", "Gear Flat"] },
            { name: "UX-01 Dran Buster 1-60A", parts: ["Dran Buster", "1-60", "Accel"] },
            { name: "UX-02 Hells Hammer 3-70H", parts: ["Hells Hammer", "3-60", "Hexa"] },
            { name: "UX-03 Wizard Rod 5-70DB", parts: ["Wizard Rod", "5-60", "Disc"] },
            { name: "UX-04 Tyranno Beat 4-70Q", parts: ["Tyranno Beat", "5-80", "Quake"] },
            { name: "UX-06 Leon Crest 7-60GN", parts: ["Leon Crest", "7-60", "Needle"] },
            { name: "CX-01 Dran Sky 2-60P", parts: ["Dran Sky", "2-60", "Point"] },
            { name: "CX-02 Hells Chain 5-60HT", parts: ["Hells Chain", "5-60", "Taper"] },
            { name: "CX-03 Phoenix Rudder 9-70G", parts: ["Phoenix Rudder", "9-60", "Glide"] }
        ];

        // --- STATE ---
        const state = {
            inventory: { blades: {}, ratchets: {}, bits: {} },
            currentBuild: { blade: null, ratchet: null, bit: null },
            deck: [null, null, null],
            chart: null
        };

        // --- INIT ---
        window.onload = () => {
            initChart();
            populateStockSelect();
            loadState();
            renderInventory();
            updateDropdowns();
            renderDeck();
        };

        function populateStockSelect() {
            const sel = document.getElementById('stockSelector');
            STOCK_PRODUCTS.forEach((p, idx) => {
                const opt = document.createElement('option');
                opt.value = idx;
                opt.textContent = p.name;
                sel.appendChild(opt);
            });
        }

        // --- INVENTORY LOGIC ---
        document.getElementById('addStockBtn').addEventListener('click', () => {
            const idx = document.getElementById('stockSelector').value;
            if (idx === "") return;
            
            const product = STOCK_PRODUCTS[idx];
            const [b, r, bit] = product.parts;

            state.inventory.blades[b] = (state.inventory.blades[b] || 0) + 1;
            state.inventory.ratchets[r] = (state.inventory.ratchets[r] || 0) + 1;
            state.inventory.bits[bit] = (state.inventory.bits[bit] || 0) + 1;

            saveState();
            renderInventory();
            updateDropdowns();
        });

        function removeItem(cat, name) {
            if (state.inventory[cat][name] > 0) {
                state.inventory[cat][name]--;
                if (state.inventory[cat][name] === 0) delete state.inventory[cat][name];
                
                // Reset build if item is gone
                if (!state.inventory[cat][name] && state.currentBuild[cat.slice(0, -1)] === name) {
                    state.currentBuild[cat.slice(0, -1)] = null;
                }
            }
            saveState();
            renderInventory();
            updateDropdowns();
        }

        function renderInventory() {
            const render = (cat, elId) => {
                const container = document.getElementById(elId);
                container.innerHTML = '';
                const items = Object.entries(state.inventory[cat]);
                
                if (items.length === 0) {
                    container.innerHTML = `<p class="text-slate-300 text-xs italic py-10 text-center border-2 border-dashed border-slate-100 rounded-2xl">Nessun componente</p>`;
                    return;
                }

                items.forEach(([name, count]) => {
                    const data = PARTS_DB[cat][name];
                    const div = document.createElement('div');
                    div.className = "inventory-card group relative bg-white border border-slate-200 p-3 rounded-xl flex justify-between items-center shadow-sm";
                    
                    let tagColor = "bg-slate-100 text-slate-500";
                    if(data.type === "Attack") tagColor = "bg-red-50 text-red-600";
                    if(data.type === "Defense") tagColor = "bg-green-50 text-green-600";
                    if(data.type === "Stamina") tagColor = "bg-yellow-50 text-yellow-600";
                    if(data.type === "Balance") tagColor = "bg-purple-50 text-purple-600";

                    div.innerHTML = `
                        <div class="flex flex-col">
                            <div class="flex items-center gap-2">
                                <span class="text-[8px] font-black uppercase px-1.5 py-0.5 rounded ${tagColor}">${data.type || data.series || 'Part'}</span>
                                <span class="text-[8px] font-bold text-slate-300 uppercase tracking-widest">${data.series || ''}</span>
                            </div>
                            <span class="text-xs font-black text-slate-700 mt-1">${name}</span>
                        </div>
                        <div class="flex items-center gap-3">
                            <span class="text-[10px] font-bold bg-slate-100 text-slate-400 px-2 py-1 rounded-lg">x${count}</span>
                            <button onclick="removeItem('${cat}', '${name}')" class="text-slate-300 hover:text-red-500 transition">üóëÔ∏è</button>
                        </div>
                    `;
                    container.appendChild(div);
                });
            };

            render('blades', 'inv-blades');
            render('ratchets', 'inv-ratchets');
            render('bits', 'inv-bits');
        }

        function updateDropdowns() {
            const sync = (id, cat, key) => {
                const sel = document.getElementById(id);
                const prev = sel.value;
                sel.innerHTML = `<option value="">Scegli ${key}...</option>`;
                Object.keys(state.inventory[cat]).forEach(name => {
                    const opt = document.createElement('option');
                    opt.value = name;
                    opt.textContent = name;
                    sel.appendChild(opt);
                });
                if(state.inventory[cat][prev]) sel.value = prev;
            };
            sync('select-blade', 'blades', 'Blade');
            sync('select-ratchet', 'ratchets', 'Ratchet');
            sync('select-bit', 'bits', 'Bit');
        }

        // --- ANALYSIS ---
        function initChart() {
            const ctx = document.getElementById('analysisChart').getContext('2d');
            state.chart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['ATTACK', 'DEFENSE', 'STAMINA', 'WEIGHT', 'BURST RES'],
                    datasets: [{
                        data: [0, 0, 0, 0, 0],
                        backgroundColor: 'rgba(37, 99, 235, 0.1)',
                        borderColor: 'rgba(37, 99, 235, 1)',
                        borderWidth: 3,
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            suggestedMin: 0,
                            suggestedMax: 100,
                            ticks: { display: false },
                            grid: { color: '#f1f5f9' },
                            angleLines: { color: '#f1f5f9' },
                            pointLabels: { font: { size: 9, weight: '900' }, color: '#94a3b8' }
                        }
                    },
                    plugins: { legend: { display: false } }
                }
            });
        }

        document.getElementById('analyzeBtn').addEventListener('click', () => {
            const b = document.getElementById('select-blade').value;
            const r = document.getElementById('select-ratchet').value;
            const bit = document.getElementById('select-bit').value;

            if(!b || !r || !bit) {
                alert("Completa la selezione dei componenti!");
                return;
            }

            const bD = PARTS_DB.blades[b];
            const rD = PARTS_DB.ratchets[r];
            const bitD = PARTS_DB.bits[bit];

            // Complex Stat Calculation
            const weightTotal = bD.weight + rD.weight + 2.2;
            const atk = Math.round((bD.stats.atk * 0.7) + (bitD.spd * 0.3));
            const def = Math.round((bD.stats.def * 0.6) + (bitD.def * 0.3) + (rD.weight * 0.2));
            const sta = Math.round((bD.stats.sta * 0.7) + (bitD.sta * 0.3));
            const wei = Math.round((weightTotal / 48) * 100); // 48g is max reference
            const res = Math.round((bD.stats.res * 0.4) + (rD.burst * 0.4) + (bitD.dsh * 0.2));

            const stats = [atk, def, sta, wei, res];
            state.chart.data.datasets[0].data = stats;
            state.chart.update();
            document.getElementById('chart-overlay').style.opacity = 0;

            // Update UI
            document.getElementById('weight-value').textContent = weightTotal.toFixed(1) + "g";
            document.getElementById('ko-value').textContent = Math.round(atk * (weightTotal/35));
            document.getElementById('type-indicator').textContent = bD.type + " Build";
            document.getElementById('type-indicator').className = `mt-1 text-[10px] font-black uppercase px-2 py-1 rounded inline-block ` + 
                (bD.type === "Attack" ? "bg-red-100 text-red-600" : bD.type === "Stamina" ? "bg-yellow-100 text-yellow-600" : "bg-blue-100 text-blue-600");

            // Grade
            const avg = stats.reduce((a,c) => a+c, 0) / 5;
            let grade = 'C';
            if (avg > 78) grade = 'S';
            else if (avg > 65) grade = 'A';
            else if (avg > 50) grade = 'B';
            
            const gBadge = document.getElementById('grade-badge');
            gBadge.className = `w-20 h-20 rounded-2xl flex flex-col items-center justify-center border-4 transition-all duration-500 grade-${grade.toLowerCase()}`;
            gBadge.querySelector('span:last-child').textContent = grade;

            // Motivation
            let motiv = `Questa combo <strong>${bD.series}</strong> sfrutta la Blade <strong>${b}</strong>. `;
            if(bD.series === "UX") motiv += `La tecnologia UX fornisce un peso superiore che garantisce stabilit√† contro colpi BX. `;
            if(bD.type === bitD.type) motiv += `La sinergia tra Blade e Bit √® eccellente, focalizzando tutta la potenza sul ruolo di <strong>${bD.type}</strong>. `;
            else motiv += `La scelta del Bit <strong>${bitD.type}</strong> crea una variante ibrida interessante. `;
            
            if(res < 45) motiv += `<br><br><span class="text-red-500 font-black uppercase text-[10px]">Pericolo Burst:</span> Bassa resistenza, evita contatti frontali.`;
            if(wei > 85) motiv += `<br><br><span class="text-green-500 font-black uppercase text-[10px]">Vantaggio Peso:</span> Difficile da spostare per KO.`;

            document.getElementById('motivation-text').innerHTML = motiv;
            document.getElementById('saveDeckBtn').disabled = false;
            
            state.currentBuild = { blade: b, ratchet: r, bit: bit, grade: grade, type: bD.type };
        });

        // --- DECK ---
        function addToDeck() {
            const slot = state.deck.findIndex(s => s === null);
            if(slot === -1) {
                alert("Deck pieno! Rimuovi una build per fare spazio.");
                return;
            }
            state.deck[slot] = {...state.currentBuild};
            renderDeck();
        }

        function renderDeck() {
            const container = document.getElementById('deck-display');
            container.innerHTML = '';
            state.deck.forEach((build, idx) => {
                const div = document.createElement('div');
                div.className = "min-h-[220px] rounded-3xl border-2 transition-all p-6 flex flex-col justify-center items-center text-center " + 
                    (build ? "bg-white border-slate-200 shadow-md" : "border-dashed border-slate-200 bg-slate-50/50");

                if(build) {
                    div.innerHTML = `
                        <div class="w-full text-left">
                            <div class="flex justify-between items-start mb-4">
                                <span class="text-[10px] font-black text-blue-600 uppercase tracking-widest">Build #${idx+1}</span>
                                <span class="font-black italic text-slate-200 text-3xl">G-${build.grade}</span>
                            </div>
                            <div class="space-y-1">
                                <p class="text-[10px] text-slate-400 font-bold uppercase">Blade</p>
                                <p class="text-sm font-black text-slate-800">${build.blade}</p>
                                <p class="text-[10px] text-slate-400 font-bold uppercase mt-2">Ratchet & Bit</p>
                                <p class="text-xs font-bold text-slate-600">${build.ratchet} / ${build.bit}</p>
                            </div>
                            <button onclick="removeFromDeck(${idx})" class="mt-6 w-full py-2 text-[10px] font-black uppercase text-red-400 hover:bg-red-50 rounded-lg transition">Rimuovi</button>
                        </div>
                    `;
                } else {
                    div.innerHTML = `
                        <span class="text-3xl opacity-20 mb-2">${idx === 0 ? 'üõ°Ô∏è' : idx === 1 ? '‚öîÔ∏è' : 'üå™Ô∏è'}</span>
                        <span class="text-[10px] font-black text-slate-300 uppercase tracking-widest">Slot Vuoto</span>
                    `;
                }
                container.appendChild(div);
            });
        }

        function removeFromDeck(idx) {
            state.deck[idx] = null;
            renderDeck();
        }

        // --- STORAGE ---
        function saveState() {
            localStorage.setItem('beylab_inventory', JSON.stringify(state.inventory));
        }
        function loadState() {
            const saved = localStorage.getItem('beylab_inventory');
            if(saved) state.inventory = JSON.parse(saved);
        }

        // --- EVENTS ---
        document.getElementById('saveDeckBtn').addEventListener('click', addToDeck);
        document.getElementById('resetBuildBtn').addEventListener('click', () => {
            document.getElementById('select-blade').value = "";
            document.getElementById('select-ratchet').value = "";
            document.getElementById('select-bit').value = "";
            state.chart.data.datasets[0].data = [0,0,0,0,0];
            state.chart.update();
            document.getElementById('chart-overlay').style.opacity = 1;
            document.getElementById('saveDeckBtn').disabled = true;
            document.getElementById('grade-badge').className = "w-20 h-20 rounded-2xl flex flex-col items-center justify-center border-4 grade-c transition-all duration-500";
            document.getElementById('grade-badge').querySelector('span:last-child').textContent = "-";
            document.getElementById('motivation-text').textContent = "In attesa di dati build...";
        });

    </script>
</body>
</html>
